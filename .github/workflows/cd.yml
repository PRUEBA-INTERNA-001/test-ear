name: Execution Weblogic Templates

on:
  pull_request:
    branches:
      - main
  workflow_dispatch:

env:
  ACTIONS_RUNNER_DEBUG: true
  ACTIONS_STEP_DEBUG: true
  
jobs:
  deploy-homo:
    uses: PRUEBA-INTERNA-001/chi-GitHub-Templates/.github/workflows/weblogic-cd.yml@main
    with:
      deploy_platform: 'linux'
      java_version: '11'
      artifacts_pattern: 'build/HelloWorldEAR.ear'
      artifacts_name: 'HelloWorldEAR'
      sonar_enabled: true  # o false, sin comillas

      #Estos son los valores que se utilizan para el deploy en la consola Weblogic
      server_host: 'weblogic.miempresa.cl'
      server_port: '7001'
      weblogic_user: 'adminweblogic'
      target_name: 'AdminServer'
      app_name: 'HelloWorldEAR'
      environment: "homologacion"
    secrets: inherit

  deploy-prod:
    needs: deploy-homo   # <--- Esto obliga a que homo termine OK primero
    uses: PRUEBA-INTERNA-001/chi-GitHub-Templates/.github/workflows/weblogic-cd.yml@main
    with:
      deploy_platform: 'linux'
      java_version: '11'
      artifacts_pattern: 'build/HelloWorldEAR.ear'
      artifacts_name: 'HelloWorldEAR'
      sonar_enabled: true  # o false, sin comillas

      #Estos son los valores que se utilizan para el deploy en la consola Weblogic
      server_host: 'weblogic.miempresa.cl'
      server_port: '7001'
      weblogic_user: 'adminweblogic'
      target_name: 'AdminServer'
      app_name: 'HelloWorldEAR'
      environment: "produccion"
    secrets: inherit
